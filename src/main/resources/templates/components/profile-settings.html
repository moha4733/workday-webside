<!DOCTYPE html>
<html lang="da" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Profil | Workday</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}">
    <link rel="stylesheet" th:href="@{/css/common/profile-settings.css}">
</head>

<body>
    <div class="dashboard-wrapper">
        <nav class="sidebar">
            <h2>Workday</h2>
            <ul>
                <li th:if="${user.role.name() == 'ADMIN'}">
                    <a th:href="@{/admin/dashboard}">Oversigt</a>
                </li>
                <li th:if="${user.role.name() == 'SVEND'}">
                    <a th:href="@{/svend/dashboard}">Oversigt</a>
                </li>
                <li><a th:href="@{/profile}" class="active">Profil</a></li>
                <li class="logout-item">
                    <form th:action="@{/logout}" method="post" style="margin: 0;">
                        <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}" />
                        <button type="submit" class="logout-button"><span><svg viewBox="0 0 24 24">
                                    <path
                                        d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                                </svg></span>Log ud</button>
                    </form>
                </li>
            </ul>
        </nav>

        <main class="main-content">
            <header>
                <h1>Min Profil</h1>
            </header>

            <div class="profile-container">
                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

                <div class="user-info">
                    <h2 th:text="${user.name}">Navn</h2>
                    <p th:text="${user.email}">email@example.com</p>
                </div>

                <div class="profile-photo-preview">
                    <img th:if="${user.profilePhotoPath != null}"
                        th:src="@{'/uploads/profiles/' + ${user.profilePhotoPath}}" alt="Profilbillede">
                    <div th:unless="${user.profilePhotoPath != null}" class="placeholder"
                        th:text="${user.name.substring(0,1).toUpperCase()}">
                    </div>
                </div>

                <form th:action="@{/profile/photo}" method="post" enctype="multipart/form-data">
                    <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}" />

                    <div class="form-group">
                        <label for="photo">Upload nyt profilbillede</label>
                        <input type="file" id="photo" name="photo" accept="image/*" required>
                        <small class="form-help">
                            Understøttede formater: JPG, PNG, GIF (maks 5MB)
                        </small>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn-primary">Upload billede</button>
                        <a th:if="${user.profilePhotoPath != null}" th:href="@{/profile/photo/delete}"
                            onclick="return confirm('Er du sikker på, at du vil slette dit profilbillede?')"
                            class="btn-danger">
                            Slet billede
                        </a>
                        <a th:href="${user.role.name() == 'ADMIN' ? '/admin/dashboard' : '/svend/dashboard'}"
                            class="btn-secondary">
                            Tilbage til dashboard
                        </a>
                    </div>
                </form>
            </div>
        </main>
    </div>
</body>

</html>